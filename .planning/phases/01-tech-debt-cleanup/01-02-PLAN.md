---
phase: 01-tech-debt-cleanup
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - FFUDevelopment/Modules/FFU.Constants/FFU.Constants.psm1
  - FFUDevelopment/Modules/FFU.Constants/FFU.Constants.psd1
  - FFUDevelopment/version.json
autonomous: true

must_haves:
  truths:
    - "Deprecated static path properties are removed from FFU.Constants"
    - "Legacy wrapper methods are removed"
    - "Dynamic GetDefaultWorkingDir() methods still work"
    - "Module version is incremented"
  artifacts:
    - path: "FFUDevelopment/Modules/FFU.Constants/FFU.Constants.psm1"
      provides: "Cleaned constants module without deprecated properties"
    - path: "FFUDevelopment/Modules/FFU.Constants/FFU.Constants.psd1"
      provides: "Updated manifest with new version"
  key_links:
    - from: "FFUDevelopment/Modules/FFU.Constants/FFU.Constants.psm1"
      to: "GetDefaultWorkingDir methods"
      via: "Dynamic path resolution"
      pattern: "GetDefault.*Dir"
---

<objective>
Remove deprecated static path properties and legacy wrapper methods from FFU.Constants module.

Purpose: Address DEBT-01 - remove deprecated code that was superseded by dynamic Get*Dir() methods in v1.2.3. Research confirms no external code references these deprecated properties.

Output: Cleaned FFU.Constants.psm1 with only the modern dynamic path resolution methods.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-tech-debt-cleanup/01-RESEARCH.md

# Key file to modify
@FFUDevelopment/Modules/FFU.Constants/FFU.Constants.psm1
@FFUDevelopment/Modules/FFU.Constants/FFU.Constants.psd1
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify no external usage of deprecated properties</name>
  <files></files>
  <action>
Before removing deprecated code, confirm no external code references these properties.

Search the entire codebase for:
1. `$DEFAULT_WORKING_DIR` (outside FFU.Constants.psm1)
2. `$DEFAULT_VM_DIR` (outside FFU.Constants.psm1)
3. `$DEFAULT_CAPTURE_DIR` (outside FFU.Constants.psm1)
4. `$DEFAULT_FFU_DIR` (outside FFU.Constants.psm1)
5. `GetWorkingDirectory` (legacy wrapper method)
6. `GetVMDirectory` (legacy wrapper method)
7. `GetCaptureDirectory` (legacy wrapper method)

Use grep to search:
```
grep -r "DEFAULT_WORKING_DIR" FFUDevelopment --include="*.ps1" --include="*.psm1" | grep -v "FFU.Constants.psm1"
grep -r "GetWorkingDirectory\|GetVMDirectory\|GetCaptureDirectory" FFUDevelopment --include="*.ps1" --include="*.psm1" | grep -v "FFU.Constants.psm1"
```

If ANY external references are found, document them and update those files to use the new methods BEFORE proceeding to removal.
  </action>
  <verify>grep commands return empty (no external references).</verify>
  <done>Confirmed: No external code references deprecated static properties or legacy wrapper methods.</done>
</task>

<task type="auto">
  <name>Task 2: Remove deprecated code from FFU.Constants.psm1</name>
  <files>FFUDevelopment/Modules/FFU.Constants/FFU.Constants.psm1</files>
  <action>
Remove the deprecated code sections from FFU.Constants.psm1:

1. Remove the static path properties region (approximately lines 255-277):
   - Look for `#region Static Path Properties (for backward compatibility)`
   - Remove the entire region including:
     - `static [string] $DEFAULT_WORKING_DIR`
     - `static [string] $DEFAULT_VM_DIR`
     - `static [string] $DEFAULT_CAPTURE_DIR`
     - `static [string] $DEFAULT_FFU_DIR`
     - Any other `$DEFAULT_*` static properties in this region
   - Remove the `#endregion`

2. Remove legacy wrapper methods (approximately lines 536-581):
   - `GetWorkingDirectory()` - wrapper that calls GetDefaultWorkingDir()
   - `GetVMDirectory()` - wrapper that calls GetDefaultVMDir()
   - `GetCaptureDirectory()` - wrapper that calls GetDefaultCaptureDir()
   - Any other legacy wrapper methods marked as deprecated

3. Keep ALL modern methods intact:
   - `GetDefaultWorkingDir()` - the correct method
   - `GetDefaultVMDir()` - the correct method
   - `GetDefaultCaptureDir()` - the correct method
   - `GetDefaultFFUDir()` - the correct method
   - All other non-deprecated functionality

4. Update any comments that reference the removed code.

IMPORTANT: Only remove code explicitly marked as deprecated. Do not touch modern GetDefault*Dir() methods.
  </action>
  <verify>
grep -c "DEPRECATED" FFUDevelopment/Modules/FFU.Constants/FFU.Constants.psm1 returns 0 (or significantly reduced).
grep -c "GetDefaultWorkingDir" FFUDevelopment/Modules/FFU.Constants/FFU.Constants.psm1 returns at least 1 (method still exists).
  </verify>
  <done>Deprecated static properties and legacy wrapper methods removed. Modern Get*Dir() methods preserved.</done>
</task>

<task type="auto">
  <name>Task 3: Update module version and run tests</name>
  <files>FFUDevelopment/Modules/FFU.Constants/FFU.Constants.psd1, FFUDevelopment/version.json</files>
  <action>
1. Increment FFU.Constants module version in the manifest:
   - Open FFU.Constants.psd1
   - Increment patch version (e.g., 1.1.0 -> 1.1.1)
   - Add release note: "Removed deprecated static path properties and legacy wrapper methods"

2. Update version.json:
   - Increment main FFUBuilder patch version
   - Update FFU.Constants version in modules section
   - Update buildDate to current date

3. Run tests to verify module still works:
   ```powershell
   Import-Module ./FFUDevelopment/Modules/FFU.Constants/FFU.Constants.psd1 -Force
   [FFUConstants]::GetDefaultWorkingDir()
   [FFUConstants]::GetDefaultVMDir()
   [FFUConstants]::GetDefaultCaptureDir()
   ```

4. Run Pester tests for the module:
   ```powershell
   Invoke-Pester -Path 'Tests/Unit/FFU.Constants*.Tests.ps1' -Output Detailed
   ```

If tests fail, fix issues before completing.
  </action>
  <verify>
Module imports without error.
GetDefault*Dir() methods return valid paths.
Pester tests pass.
  </verify>
  <done>FFU.Constants module version incremented, version.json updated, all tests pass.</done>
</task>

</tasks>

<verification>
1. No external references to deprecated properties (grep confirms)
2. FFU.Constants.psm1 has no DEPRECATED markers for path properties
3. Modern GetDefault*Dir() methods still work
4. Module manifest version incremented
5. version.json updated
6. Pester tests pass
</verification>

<success_criteria>
- DEBT-01 complete: All deprecated static path properties removed from FFU.Constants
- DEBT-01 complete: All legacy wrapper methods removed
- No regressions: Modern Get*Dir() methods work correctly
- Versioning: Module and main version incremented per versioning policy
</success_criteria>

<output>
After completion, create `.planning/phases/01-tech-debt-cleanup/01-02-SUMMARY.md`
</output>
