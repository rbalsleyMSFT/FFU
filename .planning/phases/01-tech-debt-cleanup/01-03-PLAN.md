---
phase: 01-tech-debt-cleanup
plan: 03
type: execute
wave: 2
depends_on: ["01-02"]
files_modified:
  - FFUDevelopment/Modules/FFU.ADK/FFU.ADK.psm1
  - FFUDevelopment/Modules/FFU.ADK/FFU.ADK.psd1
  - FFUDevelopment/Modules/FFU.Core/FFU.Core.psm1
  - FFUDevelopment/Modules/FFU.Core/FFU.Core.psd1
  - FFUDevelopment/version.json
autonomous: true

must_haves:
  truths:
    - "Write-Host replaced with WriteLog or Write-Verbose in FFU.ADK"
    - "Write-Host replaced with WriteLog or Write-Verbose in FFU.Core"
    - "Background job output is visible in UI Monitor tab"
  artifacts:
    - path: "FFUDevelopment/Modules/FFU.ADK/FFU.ADK.psm1"
      provides: "ADK module using proper output streams"
    - path: "FFUDevelopment/Modules/FFU.Core/FFU.Core.psm1"
      provides: "Core module using proper output streams"
  key_links:
    - from: "FFU.ADK.psm1"
      to: "WriteLog"
      via: "FFU.Common.Core import"
      pattern: "WriteLog"
---

<objective>
Replace Write-Host with proper output streams in FFU.ADK and FFU.Core modules.

Purpose: Address DEBT-03 (partial) - Write-Host output is not captured in background jobs, making UI Monitor tab unable to show progress. Replace with WriteLog (for production logging) or Write-Verbose (for diagnostic info).

Output: FFU.ADK (~7 occurrences) and FFU.Core (~3 occurrences) using proper output streams that work in background job context.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-tech-debt-cleanup/01-RESEARCH.md

# Prior plan output (if needed for context)
@.planning/phases/01-tech-debt-cleanup/01-02-SUMMARY.md

# Key files to modify
@FFUDevelopment/Modules/FFU.ADK/FFU.ADK.psm1
@FFUDevelopment/Modules/FFU.Core/FFU.Core.psm1
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace Write-Host in FFU.ADK module</name>
  <files>FFUDevelopment/Modules/FFU.ADK/FFU.ADK.psm1</files>
  <action>
Find and replace all Write-Host occurrences in FFU.ADK.psm1 (~7 expected).

For each Write-Host, apply this decision tree from research:

1. If it's returning data to the pipeline -> Write-Output
2. If it's debugging/diagnostic information -> Write-Verbose
3. If it's a warning about recoverable issues -> Write-Warning
4. If it's informational logging for production -> WriteLog

Typical replacements:
```powershell
# BEFORE (user feedback during ADK operations)
Write-Host "Checking Windows ADK installation..." -ForegroundColor Cyan

# AFTER (production logging)
WriteLog "Checking Windows ADK installation..."

# OR for verbose diagnostics
Write-Verbose "Checking Windows ADK installation..."
```

Note: Remove -ForegroundColor parameters as they only apply to Write-Host.

Ensure WriteLog is available - FFU.ADK should already import FFU.Common.Core which provides WriteLog. If not, add the import.
  </action>
  <verify>
grep -c "Write-Host" FFUDevelopment/Modules/FFU.ADK/FFU.ADK.psm1 returns 0.
Module imports without error: Import-Module FFU.ADK -Force
  </verify>
  <done>All Write-Host calls in FFU.ADK replaced with WriteLog or Write-Verbose.</done>
</task>

<task type="auto">
  <name>Task 2: Replace Write-Host in FFU.Core module</name>
  <files>FFUDevelopment/Modules/FFU.Core/FFU.Core.psm1</files>
  <action>
Find and replace all Write-Host occurrences in FFU.Core.psm1 (~3 expected).

Research notes that FFU.Core Write-Host instances are for "PowerShell version info on startup" - these should become Write-Verbose since they are diagnostic information.

Typical replacement:
```powershell
# BEFORE (PowerShell version info)
Write-Host "PowerShell Version: $($PSVersionTable.PSVersion)" -ForegroundColor Green

# AFTER (verbose diagnostic)
Write-Verbose "PowerShell Version: $($PSVersionTable.PSVersion)"
```

Apply the same decision tree as Task 1 for any other Write-Host instances found.

Remove -ForegroundColor parameters.
  </action>
  <verify>
grep -c "Write-Host" FFUDevelopment/Modules/FFU.Core/FFU.Core.psm1 returns 0.
Module imports without error: Import-Module FFU.Core -Force
  </verify>
  <done>All Write-Host calls in FFU.Core replaced with Write-Verbose or WriteLog.</done>
</task>

<task type="auto">
  <name>Task 3: Update versions and run tests</name>
  <files>FFUDevelopment/Modules/FFU.ADK/FFU.ADK.psd1, FFUDevelopment/Modules/FFU.Core/FFU.Core.psd1, FFUDevelopment/version.json</files>
  <action>
1. Update FFU.ADK.psd1:
   - Increment patch version
   - Add release note: "Replaced Write-Host with proper output streams for background job compatibility"

2. Update FFU.Core.psd1:
   - Increment patch version
   - Add release note: "Replaced Write-Host with Write-Verbose for diagnostic output"

3. Update version.json:
   - Increment main FFUBuilder patch version (if not already done in plan 01-02)
   - Update FFU.ADK and FFU.Core versions in modules section
   - Update buildDate

4. Run Pester tests:
   ```powershell
   Invoke-Pester -Path 'Tests/Unit/FFU.ADK*.Tests.ps1' -Output Detailed
   Invoke-Pester -Path 'Tests/Unit/FFU.Core*.Tests.ps1' -Output Detailed
   ```

5. Run PSScriptAnalyzer:
   ```powershell
   Invoke-ScriptAnalyzer -Path FFUDevelopment/Modules/FFU.ADK/FFU.ADK.psm1 -Severity Error
   Invoke-ScriptAnalyzer -Path FFUDevelopment/Modules/FFU.Core/FFU.Core.psm1 -Severity Error
   ```

If tests fail, fix issues before completing.
  </action>
  <verify>
Pester tests pass.
PSScriptAnalyzer reports no errors.
Both modules import cleanly.
  </verify>
  <done>Module versions incremented, version.json updated, all tests pass.</done>
</task>

</tasks>

<verification>
1. grep "Write-Host" in FFU.ADK.psm1 returns 0 matches
2. grep "Write-Host" in FFU.Core.psm1 returns 0 matches
3. Both modules import without error
4. Pester tests pass
5. PSScriptAnalyzer finds no errors
</verification>

<success_criteria>
- DEBT-03 (partial): Write-Host removed from FFU.ADK (~7 replacements)
- DEBT-03 (partial): Write-Host removed from FFU.Core (~3 replacements)
- No regressions: Modules import cleanly, tests pass
- Versioning: Module versions incremented per policy
</success_criteria>

<output>
After completion, create `.planning/phases/01-tech-debt-cleanup/01-03-SUMMARY.md`
</output>
