---
phase: 13-ui-default-fix
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - FFUDevelopment/FFUUI.Core/FFUUI.Core.psm1
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Fresh UI launch initializes IncludePreviewUpdates checkbox to unchecked (false)"
    - "Get-GeneralDefaults returns hashtable with IncludePreviewUpdates key"
    - "Existing saved configs continue to work without modification"
  artifacts:
    - path: "FFUDevelopment/FFUUI.Core/FFUUI.Core.psm1"
      provides: "IncludePreviewUpdates default value"
      contains: "IncludePreviewUpdates.*=.*\\$false"
  key_links:
    - from: "FFUUI.Core.psm1 Get-GeneralDefaults"
      to: "UI checkbox initialization"
      via: "defaults hashtable property"
      pattern: "IncludePreviewUpdates\\s*=\\s*\\$false"
---

<objective>
Add IncludePreviewUpdates to Get-GeneralDefaults function to fix checkbox initialization on fresh UI launch.

Purpose: Close gap identified in v1.8.1 milestone audit — UPD-02 requirement partial completion
Output: Get-GeneralDefaults includes `IncludePreviewUpdates = $false` in Updates Tab Defaults section
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/v1.8.1-MILESTONE-AUDIT.md
@FFUDevelopment/FFUUI.Core/FFUUI.Core.psm1
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add IncludePreviewUpdates to Get-GeneralDefaults</name>
  <files>FFUDevelopment/FFUUI.Core/FFUUI.Core.psm1</files>
  <action>
In the Get-GeneralDefaults function, locate the Updates Tab Defaults section (lines 218-226).
After line 226 (`UpdatePreviewCU = $false`), add the following line:

```powershell
IncludePreviewUpdates          = $false
```

This property should be added BEFORE the `# Applications Tab Defaults` comment (line 227).

The resulting code should look like:
```powershell
# Updates Tab Defaults
UpdateLatestCU                 = $true
UpdateLatestNet                = $true
UpdateLatestDefender           = $true
UpdateEdge                     = $true
UpdateOneDrive                 = $true
UpdateLatestMSRT               = $true
UpdateLatestMicrocode          = $false
UpdatePreviewCU                = $false
IncludePreviewUpdates          = $false
# Applications Tab Defaults
```

Maintain consistent spacing alignment (26 spaces before `=` to align with other properties).
  </action>
  <verify>
1. Grep for IncludePreviewUpdates in FFUUI.Core.psm1 confirms property exists
2. Import-Module FFUUI.Core succeeds without errors
3. (Get-GeneralDefaults).IncludePreviewUpdates returns $false
  </verify>
  <done>
Get-GeneralDefaults function returns hashtable with IncludePreviewUpdates = $false, UI checkbox initializes to unchecked on fresh launch
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify Phase 11 E2E Flow</name>
  <files>FFUDevelopment/FFUUI.Core/FFUUI.Core.psm1</files>
  <action>
Verify the complete Phase 11 E2E flow now works:

1. Schema defines IncludePreviewUpdates — already verified in Phase 11
2. Config migration adds default — already verified in Phase 11
3. UI checkbox exists — already verified in Phase 11
4. UI control registered — already verified in Phase 11
5. **UI default initialized** — verify this now works:
   - Import FFUUI.Core module
   - Call Get-GeneralDefaults
   - Confirm IncludePreviewUpdates key exists and equals $false
6. Config save includes property — already verified in Phase 11
7. Config load restores property — already verified in Phase 11
8. Build script has parameter — already verified in Phase 11
9. PreviewFilter logic works — already verified in Phase 11

Run the following verification:
```powershell
# Fresh module import
Remove-Module FFUUI.Core -Force -ErrorAction SilentlyContinue
Import-Module "FFUDevelopment/FFUUI.Core/FFUUI.Core.psd1" -Force

# Get defaults
$defaults = Get-GeneralDefaults

# Verify property exists and is false
if ($null -eq $defaults.IncludePreviewUpdates) {
    throw "IncludePreviewUpdates is null - gap not closed"
}
if ($defaults.IncludePreviewUpdates -ne $false) {
    throw "IncludePreviewUpdates is not false - unexpected value"
}
Write-Host "SUCCESS: IncludePreviewUpdates defaults to false"
```
  </action>
  <verify>
Verification script outputs "SUCCESS: IncludePreviewUpdates defaults to false"
  </verify>
  <done>
Phase 11 E2E flow Step 5 (UI default initialized) now passes, completing the flow
  </done>
</task>

</tasks>

<verification>
1. FFUUI.Core.psm1 contains `IncludePreviewUpdates = $false` in Get-GeneralDefaults
2. Module imports successfully
3. Get-GeneralDefaults returns hashtable with IncludePreviewUpdates = $false
4. No syntax errors introduced
5. Existing properties unchanged
</verification>

<success_criteria>
- Get-GeneralDefaults includes `IncludePreviewUpdates = $false`
- Fresh UI launch initializes checkbox to unchecked (false)
- Existing saved configs continue to work (no changes to config handling)
- Phase 11 E2E flow passes completely (all 9 steps)
</success_criteria>

<output>
After completion, create `.planning/phases/13-ui-default-fix/13-01-SUMMARY.md`
</output>
