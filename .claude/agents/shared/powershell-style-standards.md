# PowerShell Code Style Standards

**Reference**: [PoshCode PowerShell Practice and Style Guide](https://github.com/PoshCode/PowerShellPracticeAndStyle)

All PowerShell code generated by agents MUST follow these standards.

---

## Brace Style (One True Brace Style - OTBS)

Opening brace on SAME line as statement. Closing brace on its OWN line.

**Correct:**
```powershell
if ($condition) {
    # code
} else {
    # code
}

function Get-Something {
    [CmdletBinding()]
    param()
    # code
}
```

**Incorrect:**
```powershell
if ($condition)
{
    # code
}
```

**Exception**: Single-line scriptblocks for parameters are allowed:
```powershell
Get-ChildItem | Where-Object { $_.Length -gt 10MB }
```

---

## Naming & Commands

### Full Cmdlet Names (No Aliases)

```powershell
# CORRECT
Get-ChildItem -Path $folder
Where-Object -FilterScript { $_.Name -like '*.ps1' }
ForEach-Object -Process { $_.ToUpper() }

# INCORRECT
gci $folder
? { $_.Name -like '*.ps1' }
% { $_.ToUpper() }
```

### Explicit Parameter Names

```powershell
# CORRECT
Get-Content -Path $file -Encoding UTF8
Copy-Item -Path $source -Destination $target

# INCORRECT
Get-Content $file UTF8
Copy-Item $source $target
```

### Capitalization

- **PascalCase**: Functions, parameters, properties, global variables
- **lowercase**: Keywords (`if`, `foreach`), operators (`-eq`, `-and`)
- **UPPERCASE**: Comment-based help keywords (`.SYNOPSIS`, `.PARAMETER`)

---

## Code Layout

### Indentation

- **4 spaces** per indentation level
- No tabs

### Line Length

- **Maximum 115 characters**
- Use splatting for long commands:

```powershell
$params = @{
    Path        = $FilePath
    Destination = $TargetPath
    Force       = $true
    Recurse     = $true
}
Copy-Item @params
```

### Spacing

```powershell
# Single space around operators
$result = $a + $b
$isValid = $count -gt 0

# Single space inside scriptblocks and subexpressions
$items = Get-ChildItem | Where-Object { $_.Length -gt 1MB }
$message = "Count: $( $items.Count )"

# No space with unary operators
$i++
-not $condition
```

### Blank Lines

- **Two blank lines** around function/class definitions
- **One blank line** between related code sections
- **Single blank line** at end of file

---

## Function Structure

Required element order:

```powershell
function Get-Something {
    [CmdletBinding()]
    [OutputType([string])]
    param(
        [Parameter(Mandatory = $true)]
        [ValidateNotNullOrEmpty()]
        [string]$Name,

        [Parameter(ValueFromPipeline = $true)]
        [string[]]$InputObject
    )

    begin {
        # Initialization
    }

    process {
        # Pipeline processing - output objects here
        $InputObject
    }

    end {
        # Cleanup
    }
}
```

### Key Rules

- Always include `[CmdletBinding()]`
- Include `[OutputType()]` when returning objects
- Use validation attributes, not manual validation
- Include `process {}` block for pipeline-capable functions
- **Avoid `return` keyword** - place object on its own line

---

## Path Handling

```powershell
# CORRECT - Use $PSScriptRoot
$configPath = Join-Path -Path $PSScriptRoot -ChildPath 'config.json'
$configPath = "$PSScriptRoot\config.json"

# INCORRECT - Relative paths
$configPath = '.\config.json'
$configPath = '..\data\config.json'

# INCORRECT - Tilde for home
$userPath = '~\Documents'

# CORRECT - Cross-platform home
$userPath = Join-Path -Path $HOME -ChildPath 'Documents'
```

---

## Code Validation

Verify compliance with PSScriptAnalyzer:

```powershell
# Install if needed
Install-Module -Name PSScriptAnalyzer -Scope CurrentUser

# Analyze script
Invoke-ScriptAnalyzer -Path ./script.ps1 -Settings CodeFormatting

# Analyze with all rules
Invoke-ScriptAnalyzer -Path ./script.ps1 -Recurse -ReportSummary
```
